<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="大数据,DDIA,读书笔记," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Encoding and Evolution - Formats for Encoding Data">
<meta name="keywords" content="大数据,DDIA,读书笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="《DDIA》读与记（四）#上">
<meta property="og:url" content="https://gaufoo.com/ddia-iv-i/index.html">
<meta property="og:site_name" content="苟富">
<meta property="og:description" content="Encoding and Evolution - Formats for Encoding Data">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://gaufoo.com/images/181125/fig4-1.png">
<meta property="og:image" content="https://gaufoo.com/images/181125/fig4-2.png">
<meta property="og:image" content="https://gaufoo.com/images/181125/fig4-3.png">
<meta property="og:image" content="https://gaufoo.com/images/181125/fig4-4.png">
<meta property="og:image" content="https://gaufoo.com/images/181125/fig4-5.png">
<meta property="og:image" content="https://gaufoo.com/images/181125/fig4-6.png">
<meta property="og:updated_time" content="2018-11-26T16:01:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《DDIA》读与记（四）#上">
<meta name="twitter:description" content="Encoding and Evolution - Formats for Encoding Data">
<meta name="twitter:image" content="https://gaufoo.com/images/181125/fig4-1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://gaufoo.com/ddia-iv-i/"/>





  <title>《DDIA》读与记（四）#上 | 苟富</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?918a16b20170b5642d2b55b0793aab3a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">苟富</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-notes">
          <a href="/notes/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sticky-note"></i> <br />
            
            便签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://gaufoo.com/ddia-iv-i/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Gaufoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苟富">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">《DDIA》读与记（四）#上</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-25T21:32:00+08:00">
                2018-11-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/DDIA/" itemprop="url" rel="index">
                    <span itemprop="name">DDIA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,535 字
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Encoding and Evolution - Formats for Encoding Data</p>
<a id="more"></a>
<hr>
<p>在前面已经讨论过如何处理变化，但是对于relational database来说，通常所有data都用一个schema，很难处理变化。相反，<em>schema-on-read</em>的database不会强制schema，从而可以容纳不同时间点写入的format不同的新老数据。</p>
<p>在format变更了以后，application code通常也需要跟着改变。但现实情况是，不是所有的application code能够立马跟着变化。这就意味着一个app中，会存在新老版本的code，和新老版本format的data，从而引出两个概念：</p>
<ul>
<li><p>Backward compatibility：newer code能够读取older code写下的data。</p>
</li>
<li><p>Forward compatibility：older code能够读取newer code写下的data。</p>
</li>
</ul>
<p>Backward compatibility通常比较容易实现，通常只需要explicitly处理older format。但Forward compatibility要求更高，需要older code能够忽略newer format相较于older format的额外添加的东西。</p>
<hr>
<p>数据的representation通常有两种情况：</p>
<ul>
<li>在memory中的object, struct, list, array, hash table, tree等等。</li>
<li>需要写入file或者用network传输的数据，需要encode成some kind of self-contained sequence of bytes。</li>
</ul>
<p>The translation from the in-memory representation to a byte sequence is called <em>encoding</em>，and the reverse is called <em>decoding</em>。</p>
<h2 id="Language-Specific-Formats"><a href="#Language-Specific-Formats" class="headerlink" title="Language-Specific Formats"></a>Language-Specific Formats</h2><p>Many programming languages come with built-in support for encoding in-memory objects into byte sequences. 比如臭名昭著的java.io.Serializable，Ruby的Marshal，Python的pickle，Java第三方库Kryo。</p>
<p>虽然这些库很方便，但问题是：</p>
<ul>
<li>只能绑定到特定编程语言</li>
<li>通常decoding的过程有初始化任意类的对象的能力，attacker可以利用这个特性，构造特定的sequence byte来破坏app，很不安全</li>
<li>一般不考虑Forward compatibility和Backward compatibility</li>
<li>有的库encode和decode性能很差</li>
</ul>
<hr>
<h2 id="JSON-XML-and-Binary-Variants"><a href="#JSON-XML-and-Binary-Variants" class="headerlink" title="JSON, XML, and Binary Variants"></a>JSON, XML, and Binary Variants</h2><p>JSON，XML，CSV等都是textual format，因此是human-readable的，而它们的问题是：</p>
<ul>
<li>Encoding of numbers有许多的问题，比如对64位数字的支持，对浮点数的支持</li>
<li>JSON、XML支持Unicode字符串，但不支持binary string</li>
<li>尽管XML、JSON的schema是opinional support的，但是很难掌握</li>
<li>CSV的转义语义比较模糊</li>
</ul>
<h3 id="Binary-encoding"><a href="#Binary-encoding" class="headerlink" title="Binary encoding"></a>Binary encoding</h3><p>举例record如下：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"userName"</span>: <span class="string">"Martin"</span>,</div><div class="line">    <span class="attr">"favoriteNumber"</span>: <span class="number">1337</span>,</div><div class="line">    <span class="attr">"interests"</span>: [<span class="string">"daydreaming"</span>, <span class="string">"hacking"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>JSON的其中一种binary encoding例子为MessagePack，其长度为66个byte，比原始JSON的81个bytes占用空间小一些。从下图可以看出编码了field的type，保留了field name。</p>
<p><img src="/images/181125/fig4-1.png" width="800"></p>
<hr>
<h2 id="Thrift-and-Protocol-Buffers"><a href="#Thrift-and-Protocol-Buffers" class="headerlink" title="Thrift and Protocol Buffers"></a>Thrift and Protocol Buffers</h2><p>Apache Thrift和Protocol Buffers是类似原理的binary encoding库。</p>
<p>Thrift和Protocol Buffer都需要指定一个schema。比如Thrift interface definition language（IDL）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">struct Person &#123;</div><div class="line">    1: required string       userName,</div><div class="line">    2: optional i64          favoriteNumber,</div><div class="line">    3: optional list&lt;string&gt; interests</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Protocal Buffers的schema定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">message Person &#123;</div><div class="line">    required string user_name       = 1;</div><div class="line">    optional int64  favorite_number = 2;</div><div class="line">    repeated string interests       = 3;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Thrift和Protocol Buffer都有代码生成工具，能够利用schema生成不同编程语言的应用代码，供用户直接encode和decode记录（records）。</p>
<p>Thrift的其中一种encoding format为<em>BinaryProtocol</em>，需要59个byte：</p>
<p><img src="/images/181125/fig4-2.png" width="800"></p>
<p>Thrift的另一种encoding format为<em>CompactProtocol</em>，需要34个byte：</p>
<p><img src="/images/181125/fig4-3.png" width="800"></p>
<p>Protocol Buffers的encoding format，需要33个byte：</p>
<p><img src="/images/181125/fig4-4.png" width="800"></p>
<p>CompactProtocol和Protocol Buffers的相似之处：</p>
<ul>
<li>它们都采用field tag</li>
<li>都对数字有压缩处理</li>
<li>都有编码datatype</li>
</ul>
<p>对于schema里的<em>required</em>或者<em>optional</em>，在encoded byte中并没有指示出来，可以进行runtime check。</p>
<h3 id="Field-tags-and-schema-evolution"><a href="#Field-tags-and-schema-evolution" class="headerlink" title="Field tags and schema evolution"></a>Field tags and schema evolution</h3><p>Each field is identifed by its tag number and annotated with a datatype. 它们是这样保证compatibility的：</p>
<ul>
<li>当旧的代码读取新的record时，可以直接忽略不需要的tag number，datatype annotation提示需要跳过多少个byte。</li>
<li>新的代码可以很简单地读取旧的record，唯一的细节是：if you add a new field, you cannot make it required.</li>
<li>当删除一个field时，只能删除optional的field，而且这个field的tag number不能再使用，因为旧代码有可能还用这个tag number，会导致冲突。</li>
</ul>
<h3 id="Datatypes-and-schema-evolution"><a href="#Datatypes-and-schema-evolution" class="headerlink" title="Datatypes and schema evolution"></a>Datatypes and schema evolution</h3><p>当改变field的datatype时，有可能会损失精度和get truncated。</p>
<p>Protocol Buffers没有list和array类的datatype，而是用repeated表示list，这样有利于optional更换成repeated。新代码读取旧record时，该list field的长度为0或1。旧代码读取新record时，会读取list field中的最后一条。</p>
<p>Thrift中有list datatype，所以没有Protocol Buffers对evolution的良好支持，但是它能够支持nested lists。</p>
<hr>
<h2 id="Avro"><a href="#Avro" class="headerlink" title="Avro"></a>Avro</h2><p>Apache Avro是另一种binary encoding format，是由于Thrift不适用于Hadoop的场景而发明的。</p>
<p>Avro同样也需要schema，Avro IDL：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">record Person &#123;</div><div class="line">    string                userName;</div><div class="line">    union &#123; null, long &#125;  favoriteNumber = null;</div><div class="line">    array&lt;string&gt;         interests;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>等价的JSON表示：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"type"</span>: <span class="string">"record"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Person"</span>,</div><div class="line">    <span class="attr">"fields"</span>: [</div><div class="line">        &#123;<span class="attr">"name"</span>: <span class="string">"userName"</span>, <span class="attr">"type"</span>: <span class="string">"string"</span>&#125;,</div><div class="line">        &#123;<span class="attr">"name"</span>: <span class="string">"favoriteNumber"</span>, <span class="attr">"type"</span>: [<span class="string">"null"</span>, <span class="string">"long"</span>], <span class="attr">"default"</span>: <span class="literal">null</span>&#125;,</div><div class="line">        &#123;<span class="attr">"name"</span>: <span class="string">"interests"</span>, <span class="attr">"type"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"array"</span>, <span class="attr">"items"</span>: <span class="string">"string"</span>&#125;</div><div class="line">    ] </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Encoded byte，需要32个byte：</p>
<p><img src="/images/181125/fig4-5.png" width="800"></p>
<p>和Apache Thrift和Protocol Buffers最大的不同就是这里不再用tag number，没有编码datatype annotation。为了Parse这个binary data，需要有schema，然后按顺序go through the fields. This means that the binary data can only be decoded correctly if the code reading the data is using the <em>exact same schema</em> as the code that wrote the data.</p>
<h3 id="The-writer’s-schema-and-the-reader’s-schema"><a href="#The-writer’s-schema-and-the-reader’s-schema" class="headerlink" title="The writer’s schema and the reader’s schema"></a>The writer’s schema and the reader’s schema</h3><p>With Avro，encode data需要<em>writer’s schema</em>，decode data需要<em>reader’s schema</em>. The key idea with Avro is that the writer’s schema and the reader’s schema don’t have to be the same – they only need to be compatible.</p>
<p>只要同时有两个schema，schema resolutin matches up the field by field name. 应用会resolve这些不同：</p>
<p><img src="/images/181125/fig4-6.png" width="800"></p>
<h3 id="Schema-evolution-rules"><a href="#Schema-evolution-rules" class="headerlink" title="Schema evolution rules"></a>Schema evolution rules</h3><p>Only add or remove a field that has a default value. To use <code>null</code>, you have to use a <em>union type</em>. For example, <code>union {null, long, string} field;</code>. You can only use <code>null</code> as a default value if it is one of the braches of the union.</p>
<p>Changing the datatype of a field is possible, provided that Avro can convert the type.</p>
<h3 id="But-what-is-the-writer’s-schema"><a href="#But-what-is-the-writer’s-schema" class="headerlink" title="But what is the writer’s schema?"></a>But what is the writer’s schema?</h3><p>Reader该如何知道writer’s schema：</p>
<ul>
<li>Large file with lots of records:<br>include the writer’s schema once at the beginning of the file.</li>
<li>Database with individually written records:<br>include a version number at the beginning of every encoded record &amp;<br>fetch the writer’s schema for that for that version number for the database</li>
<li>Sending records over a network connection<br>negotiate the schema version on connection setup</li>
</ul>
<h3 id="Dynamically-generated-schemas"><a href="#Dynamically-generated-schemas" class="headerlink" title="Dynamically generated schemas"></a>Dynamically generated schemas</h3><p>Avro可以通过relational databasede field来dynamically generated schemas. 反观Apache Thrift和Protocol Buffers，则需要手动更新，而且还需要非常小心地处理field tag number的冲突问题。</p>
<h3 id="Code-generation-and-dynamically-typed-languages"><a href="#Code-generation-and-dynamically-typed-languages" class="headerlink" title="Code generation and dynamically typed languages"></a>Code generation and dynamically typed languages</h3><p>Avro can be used just as well without any code generation. If you have an object container file (which embeds the writer’s schema), you can simply open it using the Avro library and look at the data in the same way as you could look at a JSON file. The file is self-describing since it includes all the necessary metadata.</p>
<hr>
<h2 id="The-Merits-of-Schemas"><a href="#The-Merits-of-Schemas" class="headerlink" title="The Merits of Schemas"></a>The Merits of Schemas</h2><p>Protocol Buffers, Thrift, and Avro都使用schema去描述binary encoding format。实现简单，使用简单，所以使用很广泛。Schema evolution既可以带来如同schema-on-read JSON databases般的灵活性，又能保证数据的准确。</p>
<hr>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Gaufoo
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://gaufoo.com/ddia-iv-i/" title="《DDIA》读与记（四）#上">https://gaufoo.com/ddia-iv-i/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" rel="external nofollow" target="_blank">CC BY-NC-ND 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/大数据/" rel="tag"># 大数据</a>
          
            <a href="/tags/DDIA/" rel="tag"># DDIA</a>
          
            <a href="/tags/读书笔记/" rel="tag"># 读书笔记</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/ddia-iii-ii/" rel="next" title="《DDIA》读与记（三）#下">
                <i class="fa fa-chevron-left"></i> 《DDIA》读与记（三）#下
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="Gaufoo" />
          <p class="site-author-name" itemprop="name">Gaufoo</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">35</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhongzc/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/zhong-zhen-chi/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-mortar-board"></i>
                  
                    
                      知乎
                    
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-nd.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              看看他们
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://lyfoon.com/" title="lyfoon" target="_blank">lyfoon</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://passer-by.com/" title="passer-by" target="_blank">passer-by</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Language-Specific-Formats"><span class="nav-number">1.</span> <span class="nav-text">Language-Specific Formats</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSON-XML-and-Binary-Variants"><span class="nav-number">2.</span> <span class="nav-text">JSON, XML, and Binary Variants</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Binary-encoding"><span class="nav-number">2.1.</span> <span class="nav-text">Binary encoding</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Thrift-and-Protocol-Buffers"><span class="nav-number">3.</span> <span class="nav-text">Thrift and Protocol Buffers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Field-tags-and-schema-evolution"><span class="nav-number">3.1.</span> <span class="nav-text">Field tags and schema evolution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Datatypes-and-schema-evolution"><span class="nav-number">3.2.</span> <span class="nav-text">Datatypes and schema evolution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Avro"><span class="nav-number">4.</span> <span class="nav-text">Avro</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#The-writer’s-schema-and-the-reader’s-schema"><span class="nav-number">4.1.</span> <span class="nav-text">The writer’s schema and the reader’s schema</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Schema-evolution-rules"><span class="nav-number">4.2.</span> <span class="nav-text">Schema evolution rules</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#But-what-is-the-writer’s-schema"><span class="nav-number">4.3.</span> <span class="nav-text">But what is the writer’s schema?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dynamically-generated-schemas"><span class="nav-number">4.4.</span> <span class="nav-text">Dynamically generated schemas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Code-generation-and-dynamically-typed-languages"><span class="nav-number">4.5.</span> <span class="nav-text">Code generation and dynamically typed languages</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Merits-of-Schemas"><span class="nav-number">5.</span> <span class="nav-text">The Merits of Schemas</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 &mdash; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gaufoo</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
