<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="大数据,DDIA,读书笔记," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Storage and Retrieval - Data Structures That Power Your Database">
<meta name="keywords" content="大数据,DDIA,读书笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="《DDIA》读与记（三）#上">
<meta property="og:url" content="https://gaufoo.com/ddia-iii-i/index.html">
<meta property="og:site_name" content="苟富">
<meta property="og:description" content="Storage and Retrieval - Data Structures That Power Your Database">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://gaufoo.com/images/181123/fig3-1.png">
<meta property="og:image" content="https://gaufoo.com/images/181123/fig3-3.png">
<meta property="og:image" content="https://gaufoo.com/images/181123/fig3-4.png">
<meta property="og:image" content="https://gaufoo.com/images/181123/fig3-5.png">
<meta property="og:image" content="https://gaufoo.com/images/181123/fig3-6.png">
<meta property="og:image" content="https://gaufoo.com/images/181123/fig3-7.png">
<meta property="og:updated_time" content="2018-11-23T08:42:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《DDIA》读与记（三）#上">
<meta name="twitter:description" content="Storage and Retrieval - Data Structures That Power Your Database">
<meta name="twitter:image" content="https://gaufoo.com/images/181123/fig3-1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://gaufoo.com/ddia-iii-i/"/>





  <title>《DDIA》读与记（三）#上 | 苟富</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?918a16b20170b5642d2b55b0793aab3a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">苟富</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-notes">
          <a href="/notes/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sticky-note"></i> <br />
            
            便签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://gaufoo.com/ddia-iii-i/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Gaufoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苟富">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">《DDIA》读与记（三）#上</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-23T01:11:00+08:00">
                2018-11-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/DDIA/" itemprop="url" rel="index">
                    <span itemprop="name">DDIA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,415 字
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Storage and Retrieval - Data Structures That Power Your Database</p>
<a id="more"></a>
<hr>
<h2 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h2><p>最简单的数据库，用bash脚本写就：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="function"><span class="title">db_set</span></span> () &#123;</div><div class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span>,<span class="variable">$2</span>"</span> &gt;&gt; database</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">db_get</span></span> () &#123;</div><div class="line">    grep <span class="string">"^<span class="variable">$1</span>,"</span> database | sed -e <span class="string">"s/^<span class="variable">$1</span>,//"</span> | tail -n 1</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>存取方式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ db_set 123456 <span class="string">'&#123;"name":"London","attractions":["Big Ben","London Eye"]&#125;'</span></div><div class="line"></div><div class="line">$ db_set 42 <span class="string">'&#123;"name":"San Francisco","attractions":["Golden Gate Bridge"]&#125;'</span></div><div class="line"></div><div class="line">$ db_get 42</div><div class="line">&#123;<span class="string">"name"</span>:<span class="string">"San Francisco"</span>,<span class="string">"attractions"</span>:[<span class="string">"Golden Gate Bridge"</span>]&#125;</div></pre></td></tr></table></figure></p>
<p>更新value，直接append，<code>db_get</code>函数只取最后一条：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ db_set 42 <span class="string">'&#123;"name":"San Francisco","attractions":["Exploratorium"]&#125;'</span> </div><div class="line"></div><div class="line">$ db_get 42</div><div class="line">&#123;<span class="string">"name"</span>:<span class="string">"San Francisco"</span>,<span class="string">"attractions"</span>:[<span class="string">"Exploratorium"</span>]&#125;</div><div class="line"></div><div class="line">$ cat database</div><div class="line">123456,&#123;<span class="string">"name"</span>:<span class="string">"London"</span>,<span class="string">"attractions"</span>:[<span class="string">"Big Ben"</span>,<span class="string">"London Eye"</span>]&#125;</div><div class="line">42,&#123;<span class="string">"name"</span>:<span class="string">"San Francisco"</span>,<span class="string">"attractions"</span>:[<span class="string">"Golden Gate Bridge"</span>]&#125;</div><div class="line">42,&#123;<span class="string">"name"</span>:<span class="string">"San Francisco"</span>,<span class="string">"attractions"</span>:[<span class="string">"Exploratorium"</span>]&#125;</div></pre></td></tr></table></figure></p>
<p>记录是直接append到文件中去的，类似这样的database，我们称该文件为append-only data file，叫做<em>log</em>。<br>在上面的bash数据库中，<code>db_get</code>很慢，复杂度为O(n)，但优势在于文件的append很快，因此<code>db_set</code>非常efficient。</p>
<hr>
<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><p>可以用额外的一种数据结构<em>index</em>，来帮助从database中有效地（efficiently）查找value。而这种额外的（additional）的结构会带来额外的开销，特别是在写入时。作为well-chosen的index可能会加速读查找（read queries），但index是必然会减慢读（write）的。所以database默认不会有index，需要用户手动选择使用index。</p>
<h3 id="Hash-Indexes"><a href="#Hash-Indexes" class="headerlink" title="Hash Indexes"></a>Hash Indexes</h3><p>每条记录（data）都直接append到文件中，实际可以在内存中维护一个hash map，每个key映射到（map to）文件中记录（data）所处在的byte offset。</p>
<p>当添加新纪录时，一边更新内存中的hash map，一边将key-value append到文件中。更新记录时，一边更新内存中该key的value，which is 最新记录的offset。</p>
<p><img src="/images/181123/fig3-1.png" width="600/"></p>
<p>不过用hash map的一个前提是，所有的key能够完全装进内存中，所以适用于经常用key来更新value，很多write操作的场景，而不同的（distinct）key不能太多，否则可能不能完全装进内存。</p>
<p>由于所有的write都是append到文件中的，此时可以break the log into <em>segments</em> of a certain size，当segment file到达这个size以后，关闭该文件，然后再写入新的segment file。每个segment file对应内存中一个hash map。</p>
<p>到了一个合适的时间点，就可以进行compact了。多个segment file compact到新的segment file，并构建新的hash map。compact的过程同一条记录保留最新的记录即可，旧的可以直接discard。并且这个compaction可以在后台线程（background thread）进行，不会影响正常的读写请求。</p>
<p><img src="/images/181123/fig3-3.png" width="600/"></p>
<p>当需要查找value时，首先check the most recent segment’s hash map，如果没有，则check the second-most-recent segment，and so on.</p>
<p>有一些常见的实际做法in practice：</p>
<ul>
<li><p>File format<br>可以用binary format，而不是CSV。</p>
</li>
<li><p>Deleting records<br>删除记录时，需要append一个特殊的deletion record，merge的时候就可以直接discard掉记录。</p>
</li>
<li><p>Crash recovery<br>万一内存中的hash map不见了，可以通过segment重新构建，也可以为hash map存些snapshot。</p>
</li>
<li><p>Partially written records<br>添加checksums，识别因为crash而产生的halfway。</p>
</li>
<li><p>Concurrency control<br>虽然由于写有严格顺序，只能有一个写进程，但是读进程可以有很多个，因为segment都是immutable，并发很简单。</p>
</li>
</ul>
<p>为什么不update the file in place：</p>
<ul>
<li>Append是sequential write operation，比random write要快得多。</li>
<li>Concurrency和Crash recovery很轻松。</li>
<li>合并旧段可以避免数据文件随着时间的推移而分散的问题。</li>
</ul>
<p>hash table index的缺点：</p>
<ul>
<li>必须在内存</li>
<li>range queries太慢</li>
</ul>
<hr>
<h3 id="SSTables-and-LSM-Trees"><a href="#SSTables-and-LSM-Trees" class="headerlink" title="SSTables and LSM-Trees"></a>SSTables and LSM-Trees</h3><p>通过改造segment file，使其sorted by key，就是Sorted String Table了，简称SSTable。有以下好处：</p>
<ul>
<li>Merging segments is simple and efficient. Merge过程很像mergesort。最终只需要保留最新的key-value。</li>
</ul>
<p><img src="/images/181123/fig3-4.png" width="600/"></p>
<ul>
<li>无需保存所有的key在内存，只需要留一些key作为路标，找到区间后，再到相应的segment file里去scan。如果每条记录都是定长的，甚至可以用binary search。</li>
</ul>
<p><img src="/images/181123/fig3-5.png" width="600/"></p>
<ul>
<li>一个范围内的记录可以组织成一个Block，然后进行compress，一能saving disk space，二能reduces the I/O bandwidth use.</li>
</ul>
<h4 id="Constucting-and-maintaining-SSTables"><a href="#Constucting-and-maintaining-SSTables" class="headerlink" title="Constucting and maintaining SSTables"></a>Constucting and maintaining SSTables</h4><p>首先在内存中构建sorted的记录，比如用red-black tress或AVL trees。用这种数据结构，插入key时可以保留sorted order。</p>
<p>storage engine具体操作：</p>
<ul>
<li>When a write comes in, 将key-value加到in-memory tree，也称memtable。</li>
<li>当memtable大小达到threshold，将它写到SSTable中。</li>
<li>查找记录时，先在memtable找，然后从most recent one-disk segment找，然后在next-older segment, etc.</li>
<li>merging和compaction过程可以在background。</li>
</ul>
<h4 id="Makeing-an-LSM-tree-out-of-SSTables"><a href="#Makeing-an-LSM-tree-out-of-SSTables" class="headerlink" title="Makeing an LSM-tree out of SSTables"></a>Makeing an LSM-tree out of SSTables</h4><p>Originally this indexing structure was described by Patrick O’Neil et al. under the name <em>Log-Structured Merge-Tree</em> (or LSM-Tree), building on earlier work on log-structured filesystems. Storage engines that are based on this principle of merging and compacting sorted files often called LSM storage engines.</p>
<h4 id="Performance-optimizations"><a href="#Performance-optimizations" class="headerlink" title="Performance optimizations"></a>Performance optimizations</h4><p>确定一个key不存在于database的过程，是比较慢的。需要先找memtable，再是所有segment，最后才能确定key不存在。可以采用额外的Bloom filters来优化这个过程。它能告诉你一个key保证不在database中，这样相比之前就节省了相当多的disk read。<br>而有关determine the order and timing of how SSTables are compacted and merged的策略，有两种最常见做法：</p>
<ul>
<li>size-tiered：新的和小的SSTables持续地合并到老的和大的SSTables。</li>
<li>leveled compaction：the key range is split up into smaller SSTables and older data is moved into separate “levels,” which allows the compaction to proceed more incrementally and use less disk space.</li>
</ul>
<hr>
<h3 id="B-Trees"><a href="#B-Trees" class="headerlink" title="B-Trees"></a>B-Trees</h3><p>B-Trees和SSTables一样，都能让key-value pairs根据sorted key来组织，都能高效地支持key value lookup和range queries。</p>
<p>log-structured index是将database切分成多个variable-size的segment。相反，B-Trees将database切分成fixed-size的block或者page，一般是4KB大小，和底层硬件关联密切。</p>
<p>每个page都可以由address或者location来identified，因此page直接可以相互refer to，on disk instead of in memory. </p>
<p><img src="/images/181123/fig3-6.png" width="600/"></p>
<p>查询从root page开始，每个page包含很多key和到child page的reference，每个child page代表一个连续范围内的key。名词branching factor代表一个page里包含的reference数，比如上图的branching factor是6，In practice，这个数字一般是几百。</p>
<p>当需要更新一个value时，需要search到包含该key的leaf page，改变value，然后将page写回到disk。当需要add一个新的key，需要找到相应的range并加入到该page，如果空间不足以accommodate新的key，则需要split到两个half-full page，然后parent page需要跟着更新。此算法保证了整个tree的balanced。</p>
<p><img src="/images/181123/fig3-7.png" width="600/"></p>
<h4 id="Make-B-trees-reliable"><a href="#Make-B-trees-reliable" class="headerlink" title="Make B-trees reliable"></a>Make B-trees reliable</h4><p>和LSM-trees的append不同，B-trees modify files in place. 任何修改都要覆写之前的文件。当child page需要split时，还需要同时改写parent page，所有的这些覆写和重写，都存在crash的可能，这将导致严重的问题。</p>
<p>为了解决这个问题，一般采用一个额外的在disk上的data structure，<em>write-ahead log</em>（WAL，也叫redo log），是一个append-only file，以供crash发生时的恢复。in place还带来concurrency问题，需要用<em>latches</em>（lightweight locks）来保证一致性。</p>
<h4 id="B-tree-optimizations"><a href="#B-tree-optimizations" class="headerlink" title="B-tree optimizations"></a>B-tree optimizations</h4><ul>
<li>不覆写，不维护WAL，而采用<em>copy-on-write scheme</em>，不再in place，全部写到新的page，连同parent page。</li>
<li>B-tree可以重新组织，让leaf page在disk中相互靠近。但是在B-tree中维护这种结构比在LSM-Tree中难得多。</li>
<li>额外的指针连接两个leaf page，这样有助于优化scan过程，而不用回到parent page。</li>
<li>B-tree的变种借助一些log-structured的思想来减少disk seek。</li>
</ul>
<hr>
<h3 id="Comparing-B-Trees-and-LSM-Trees"><a href="#Comparing-B-Trees-and-LSM-Trees" class="headerlink" title="Comparing B-Trees and LSM-Trees"></a>Comparing B-Trees and LSM-Trees</h3><ul>
<li>LSM-trees的优势<br>LSM-trees由于SSTable file只需要sequential write，而拥有更低的write amplification。B-tree因为page中有很多fragmentation是未被使用的，而LSM-trees则紧凑得多。</li>
<li>LSM-trees的缺点<br>compaction的过程占用了disk的bandwidth，which is稀缺资源。如果compaction配置得不好，还有可能compaction不充分而导致read过程需要寻找太多segment file，从而使得表现很差。B-tree其中一个优势是，对于transaction semantics有相当直接的实现：用lock就完事儿了。</li>
</ul>
<hr>
<h3 id="Other-Indexing-Structures"><a href="#Other-Indexing-Structures" class="headerlink" title="Other Indexing Structures"></a>Other Indexing Structures</h3><h4 id="Storing-values-within-the-index"><a href="#Storing-values-within-the-index" class="headerlink" title="Storing values within the index"></a>Storing values within the index</h4><p>value可以直接存储，或者在别处的row的一个reference。对于后一种情况，存储row的地方叫做<em>heap file</em>。当更新值时，如果新row大小不超过原大小，可以直接覆写in place，如果超过了，要么重写reference到新的heap file，要么在原来的row处放上一个forwarding pointer。对于直接和index一起存储的row，称为<em>clustered index</em>。也有折衷的方案，某些column和index一起存，某些column则采用引用，称为<em>covering index</em>。</p>
<h4 id="Multi-column-indexes"><a href="#Multi-column-indexes" class="headerlink" title="Multi-column indexes"></a>Multi-column indexes</h4><p>有一种Multi-dimensional indexes可以进行多维同时range queries：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> restaurants <span class="keyword">WHERE</span> latitude &gt; <span class="number">51.4946</span> <span class="keyword">AND</span> latitude &lt; <span class="number">51.5079</span> </div><div class="line">                           <span class="keyword">AND</span> longitude &gt; <span class="number">-0.1162</span> <span class="keyword">AND</span> longitude &lt; <span class="number">-0.1004</span>;</div></pre></td></tr></table></figure></p>
<p>这样的查询对于B-tree或者LSM-tree都不是很efficient，需要多个步骤来查询。而有些index可以同时从多维narrow down。</p>
<h4 id="Full-text-search-and-fuzzy-indexes"><a href="#Full-text-search-and-fuzzy-indexes" class="headerlink" title="Full-text search and fuzzy indexes"></a>Full-text search and fuzzy indexes</h4><p>上面提到的index都是精确的key来查找精确的value。现实中也有similar key，比如拼错的单词。需要用edit distance的offset来决定匹配值。</p>
<h4 id="Keeping-everything-in-memory"><a href="#Keeping-everything-in-memory" class="headerlink" title="Keeping everything in memory"></a>Keeping everything in memory</h4><p>之前提到的data structure都是面向disk的，实际上也有面向RAM的结构。在RAM中的结构要比在disk中灵活得多，而且增删查改更快更有效。</p>
<p>有关易失性，可以replicate到其他机器，可以在disk中保留snapshot，可以在disk写log以供恢复。</p>
<p>比较反直觉的一件事是，disk-based存储比in-memory慢的原因不是因为需要从disk中获取，事实上只要RAM够大，cache能够帮助你完全不需要从disk中读写。实际情况是disk-based慢在了encoding过程。</p>
<p>Redis为各种数据结构（如优先级队列和集合）提供了类似数据库的接口。因为它将所有数据保存在内存中，所以它的实现相对简单。</p>
<p>利用anti-caching技术可以在memory不足时将data转到disk上，有非常多类似的研究in-memory databases，而不再用disk-centric architecture。</p>
<hr>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Gaufoo
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://gaufoo.com/ddia-iii-i/" title="《DDIA》读与记（三）#上">https://gaufoo.com/ddia-iii-i/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" rel="external nofollow" target="_blank">CC BY-NC-ND 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/大数据/" rel="tag"># 大数据</a>
          
            <a href="/tags/DDIA/" rel="tag"># DDIA</a>
          
            <a href="/tags/读书笔记/" rel="tag"># 读书笔记</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/ddia-ii/" rel="next" title="《DDIA》读与记（二）">
                <i class="fa fa-chevron-left"></i> 《DDIA》读与记（二）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/ddia-iii-ii/" rel="prev" title="《DDIA》读与记（三）#下">
                《DDIA》读与记（三）#下 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="Gaufoo" />
          <p class="site-author-name" itemprop="name">Gaufoo</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhongzc/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/zhong-zhen-chi/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-mortar-board"></i>
                  
                    
                      知乎
                    
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-nd.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              看看他们
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://lyfoon.com/" title="lyfoon" target="_blank">lyfoon</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://passer-by.com/" title="passer-by" target="_blank">passer-by</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Log"><span class="nav-number">1.</span> <span class="nav-text">Log</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Index"><span class="nav-number">2.</span> <span class="nav-text">Index</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash-Indexes"><span class="nav-number">2.1.</span> <span class="nav-text">Hash Indexes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSTables-and-LSM-Trees"><span class="nav-number">2.2.</span> <span class="nav-text">SSTables and LSM-Trees</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Constucting-and-maintaining-SSTables"><span class="nav-number">2.2.1.</span> <span class="nav-text">Constucting and maintaining SSTables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Makeing-an-LSM-tree-out-of-SSTables"><span class="nav-number">2.2.2.</span> <span class="nav-text">Makeing an LSM-tree out of SSTables</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Performance-optimizations"><span class="nav-number">2.2.3.</span> <span class="nav-text">Performance optimizations</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#B-Trees"><span class="nav-number">2.3.</span> <span class="nav-text">B-Trees</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Make-B-trees-reliable"><span class="nav-number">2.3.1.</span> <span class="nav-text">Make B-trees reliable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#B-tree-optimizations"><span class="nav-number">2.3.2.</span> <span class="nav-text">B-tree optimizations</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Comparing-B-Trees-and-LSM-Trees"><span class="nav-number">2.4.</span> <span class="nav-text">Comparing B-Trees and LSM-Trees</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Other-Indexing-Structures"><span class="nav-number">2.5.</span> <span class="nav-text">Other Indexing Structures</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Storing-values-within-the-index"><span class="nav-number">2.5.1.</span> <span class="nav-text">Storing values within the index</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Multi-column-indexes"><span class="nav-number">2.5.2.</span> <span class="nav-text">Multi-column indexes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Full-text-search-and-fuzzy-indexes"><span class="nav-number">2.5.3.</span> <span class="nav-text">Full-text search and fuzzy indexes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Keeping-everything-in-memory"><span class="nav-number">2.5.4.</span> <span class="nav-text">Keeping everything in memory</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 &mdash; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gaufoo</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
